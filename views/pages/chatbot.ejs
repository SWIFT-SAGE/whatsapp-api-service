<!-- Chatbot Section -->
<div id="dashboard-chatbot" class="dashboard-section">
    <!-- Header -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <div>
            <h2 class="mb-1">
                <i class="fas fa-robot me-2 text-primary"></i>Chatbot Management
            </h2>
            <p class="text-muted mb-0">Configure automated responses and AI-powered conversations</p>
        </div>
        <div class="d-flex gap-2">
            <button type="button" class="btn btn-outline-primary" id="refresh-bot-btn">
                <i class="fas fa-sync-alt me-2"></i>Refresh
            </button>
            <button type="button" class="btn btn-primary" id="create-bot-btn">
                <i class="fas fa-plus me-2"></i>Create Bot
            </button>
        </div>
    </div>

    <!-- Bot Status Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                                        <i class="fas fa-robot fa-2x text-primary"></i>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="mb-1" id="bot-name">No Bot Configured</h5>
                                    <p class="text-muted mb-0" id="bot-description">Create a bot to start automating
                                        conversations</p>
                                    <div class="mt-2">
                                        <span class="badge bg-secondary" id="bot-status-badge">Inactive</span>
                                        <span class="badge bg-info ms-2" id="bot-flows-count">0 Flows</span>
                                        <span class="badge bg-success ms-2" id="bot-ai-status">AI Ready</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <div class="d-flex flex-column gap-2">
                                <button type="button" class="btn btn-sm btn-outline-success" id="toggle-bot-btn"
                                    disabled>
                                    <i class="fas fa-power-off me-2"></i>Activate Bot
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="edit-bot-btn" disabled>
                                    <i class="fas fa-edit me-2"></i>Edit Bot
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Bot Flows -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-stream me-2 text-primary"></i>Conversation Flows
                    </h5>
                    <button type="button" class="btn btn-sm btn-primary" id="add-flow-btn" disabled>
                        <i class="fas fa-plus me-2"></i>Add Flow
                    </button>
                </div>
                <div class="card-body" id="bot-flows-container">
                    <!-- Flows will be loaded here -->
                    <div class="text-center py-5">
                        <i class="fas fa-robot fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">No Bot Configured</h5>
                        <p class="text-muted">Create a bot to start adding conversation flows</p>
                        <button type="button" class="btn btn-primary"
                            onclick="document.getElementById('create-bot-btn').click()">
                            <i class="fas fa-plus me-2"></i>Create Your First Bot
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bot Analytics -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2 text-primary"></i>Bot Analytics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-comments fa-2x text-primary mb-2"></i>
                                <h3 class="mb-0" id="bot-total-conversations">0</h3>
                                <p class="text-muted mb-0">Conversations</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-envelope fa-2x text-success mb-2"></i>
                                <h3 class="mb-0" id="bot-total-messages">0</h3>
                                <p class="text-muted mb-0">Messages</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-clock fa-2x text-info mb-2"></i>
                                <h3 class="mb-0" id="bot-last-used">Never</h3>
                                <p class="text-muted mb-0">Last Used</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Bot & Settings -->
        <div class="col-lg-4">
            <!-- Test Bot -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="fas fa-vial me-2 text-primary"></i>Test Bot
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Test Message</label>
                        <input type="text" class="form-control" id="test-message-input"
                            placeholder="Type a message to test..." disabled>
                        <small class="text-muted">Try keywords like "hi", "help", etc.</small>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="test-bot-btn" disabled>
                        <i class="fas fa-paper-plane me-2"></i>Send Test
                    </button>
                    <div id="test-response-container" class="mt-3"></div>
                </div>
            </div>

            <!-- AI Configuration -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="fas fa-brain me-2 text-primary"></i>AI Configuration
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label mb-0">AI Fallback</label>
                            <span class="badge bg-success" id="ai-status-indicator">Enabled</span>
                        </div>
                        <small class="text-muted">
                            AI will respond when no flow matches
                        </small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Provider</label>
                        <input type="text" class="form-control" id="ai-provider" value="Gemini AI" disabled readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Model</label>
                        <input type="text" class="form-control" id="ai-model" value="gemini-pro" disabled readonly>
                    </div>
                    <div class="alert alert-info mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        <small>Configure AI settings in your .env file</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Bot Modal -->
<div class="modal fade" id="botModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-robot me-2"></i><span id="bot-modal-title">Create Bot</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="bot-form">
                    <input type="hidden" id="bot-id">

                    <!-- Session Selection -->
                    <div class="mb-3">
                        <label class="form-label">WhatsApp Session <span class="text-danger">*</span></label>
                        <select class="form-select" id="bot-session-id" required>
                            <option value="">Select a session...</option>
                        </select>
                        <small class="text-muted">Bot will respond to messages on this session</small>
                    </div>

                    <!-- Bot Name -->
                    <div class="mb-3">
                        <label class="form-label">Bot Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="bot-name-input"
                            placeholder="e.g., Customer Support Bot" required>
                    </div>

                    <!-- Bot Description -->
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="bot-description-input" rows="2"
                            placeholder="Brief description of what this bot does"></textarea>
                    </div>

                    <!-- Bot Purpose -->
                    <div class="mb-3">
                        <label class="form-label">Bot Purpose (for AI)</label>
                        <input type="text" class="form-control" id="bot-purpose-input"
                            placeholder="e.g., Customer Support, Sales Assistant">
                        <small class="text-muted">Defines the bot's role for AI responses</small>
                    </div>

                    <!-- AI Configuration -->
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-brain me-2 text-primary"></i>AI Configuration
                            </h6>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" id="bot-ai-enabled"
                                    onchange="document.getElementById('ai-config-section').style.display = this.checked ? 'block' : 'none'">
                                <label class="form-check-label" for="bot-ai-enabled">Enable AI</label>
                            </div>
                        </div>
                        <div class="card-body" id="ai-config-section" style="display: none;">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Bot Mode</label>
                                    <select class="form-select" id="bot-ai-mode">
                                        <option value="hybrid">Hybrid (Flows + AI)</option>
                                        <option value="ai_only">AI Only</option>
                                        <option value="flows_only">Flows Only</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">AI Provider</label>
                                    <select class="form-select" id="bot-ai-provider">
                                        <option value="gemini">Google Gemini</option>
                                        <option value="openai">OpenAI (GPT)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">System Prompt</label>
                                <textarea class="form-control" id="bot-ai-prompt" rows="3"
                                    placeholder="Instructions for the AI (e.g., 'You are a helpful support agent...')"></textarea>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Model (Optional)</label>
                                    <input type="text" class="form-control" id="bot-ai-model"
                                        placeholder="e.g., gemini-1.5-flash">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">API Key (Optional)</label>
                                    <input type="password" class="form-control" id="bot-ai-api-key"
                                        placeholder="Leave empty to use system key">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Temperature (0-1)</label>
                                    <input type="number" class="form-control" id="bot-ai-temperature" min="0" max="1"
                                        step="0.1" value="0.7">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Max Tokens</label>
                                    <input type="number" class="form-control" id="bot-ai-tokens" min="50" max="2000"
                                        step="50" value="500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">General Settings</h6>
                        </div>
                        <div class="card-body">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="bot-enable-groups">
                                <label class="form-check-label" for="bot-enable-groups">
                                    Enable in Group Chats
                                </label>
                            </div>

                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="bot-enable-unknown" checked>
                                <label class="form-check-label" for="bot-enable-unknown">
                                    Respond to Unknown Contacts
                                </label>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Fallback Message</label>
                                <textarea class="form-control" id="bot-fallback-message" rows="2"
                                    placeholder="Message when bot doesn't understand"></textarea>
                                <small class="text-muted">Shown when no flow matches and AI is disabled/fails</small>
                            </div>

                            <!-- Working Hours -->
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="bot-working-hours-enabled">
                                <label class="form-check-label" for="bot-working-hours-enabled">
                                    Enable Working Hours
                                </label>
                            </div>

                            <div id="working-hours-config" style="display: none;">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Start Time</label>
                                        <input type="time" class="form-control" id="bot-working-start" value="09:00">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">End Time</label>
                                        <input type="time" class="form-control" id="bot-working-end" value="18:00">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Working Days</label>
                                    <div class="d-flex flex-wrap gap-2">
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="1"
                                                id="day-mon" checked>
                                            <label class="form-check-label" for="day-mon">Mon</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="2"
                                                id="day-tue" checked>
                                            <label class="form-check-label" for="day-tue">Tue</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="3"
                                                id="day-wed" checked>
                                            <label class="form-check-label" for="day-wed">Wed</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="4"
                                                id="day-thu" checked>
                                            <label class="form-check-label" for="day-thu">Thu</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="5"
                                                id="day-fri" checked>
                                            <label class="form-check-label" for="day-fri">Fri</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="6"
                                                id="day-sat">
                                            <label class="form-check-label" for="day-sat">Sat</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input working-day" type="checkbox" value="0"
                                                id="day-sun">
                                            <label class="form-check-label" for="day-sun">Sun</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-bot-btn">
                    <i class="fas fa-save me-2"></i>Save Bot
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Flow Modal -->
<div class="modal fade" id="flowModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-stream me-2"></i><span id="flow-modal-title">Add Flow</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="flow-form">
                    <input type="hidden" id="flow-id">

                    <!-- Flow Name -->
                    <div class="mb-3">
                        <label class="form-label">Flow Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="flow-name" placeholder="e.g., Welcome Message"
                            required>
                    </div>

                    <!-- Trigger Configuration -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Trigger</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Trigger Type</label>
                                    <select class="form-select" id="flow-trigger-type">
                                        <option value="keyword">Keyword</option>
                                        <option value="menu">Menu Option</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Trigger Value <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="flow-trigger-value"
                                        placeholder="e.g., hi, hello, help" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Case</label>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="flow-case-sensitive">
                                        <label class="form-check-label" for="flow-case-sensitive">
                                            <small>Sensitive</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Responses -->
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Responses</h6>
                            <button type="button" class="btn btn-sm btn-primary" id="add-response-btn">
                                <i class="fas fa-plus me-2"></i>Add Response
                            </button>
                        </div>
                        <div class="card-body" id="responses-container">
                            <!-- Responses will be added here -->
                        </div>
                    </div>

                    <!-- Flow Status -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flow-active" checked>
                        <label class="form-check-label" for="flow-active">
                            Flow is Active
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-flow-btn">
                    <i class="fas fa-save me-2"></i>Save Flow
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .flow-card {
        transition: all 0.3s ease;
        border-left: 4px solid #0d6efd;
    }

    .flow-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .response-item {
        border-left: 3px solid #198754;
        background: #f8f9fa;
    }

    .test-response {
        background: #e7f3ff;
        border-left: 4px solid #0d6efd;
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
    }

    .test-response.success {
        background: #d1e7dd;
        border-left-color: #198754;
    }

    .test-response.error {
        background: #f8d7da;
        border-left-color: #dc3545;
    }
</style>