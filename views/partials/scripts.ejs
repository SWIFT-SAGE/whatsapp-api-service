<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Initialize authentication token for client-side API calls -->
    <script>
        <% if (typeof authToken !== 'undefined' && authToken) { %>
            // Set the auth token in sessionStorage for API calls
            sessionStorage.setItem('authToken', '<%= authToken %>');
            sessionStorage.setItem('isLoggedIn', 'true');
            
            // Also set current user data if available
            <% if (typeof user !== 'undefined' && user) { %>
                sessionStorage.setItem('currentUser', JSON.stringify({
                    name: '<%= user.name %>',
                    email: '<%= user.email %>',
                    apiKey: '<%= user.apiKey %>',
                    subscription: {
                        plan: '<%= user.subscription.plan %>',
                        messageCount: <%= user.subscription.messageCount %>,
                        messageLimit: <%= user.subscription.messageLimit %>
                    }
                }));
            <% } %>
        <% } else { %>
            // Clear any existing auth data if no token
            sessionStorage.clear();
            localStorage.clear();
            
            // Clear specific auth items
            sessionStorage.removeItem('authToken');
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('currentUser');
            localStorage.removeItem('authToken');
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
        <% } %>
        
        // Global logout function
        window.completeLogout = function() {
            // Clear all browser storage
            sessionStorage.clear();
            localStorage.clear();
            
            // Clear all possible auth cookies
            const cookiesToClear = ['authToken', 'token', 'jwt', 'connect.sid'];
            cookiesToClear.forEach(function(cookieName) {
                document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + window.location.hostname + ';';
                // Also try with leading dot for subdomain support
                document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.' + window.location.hostname + ';';
            });
            
            // Force redirect to login
            window.location.replace('/login?logout=true');
        };
    </script>
    
    <script src="/app.js"></script>

